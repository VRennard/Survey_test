// src/Survey.jsx
import React, { useState } from "react";
import { db } from "./firebase"; // make sure firebase.js exports db
import { collection, addDoc, Timestamp } from "firebase/firestore";

const Survey = () => {
  const [responses, setResponses] = useState({
    q1: 3,
    q2: 3,
    q3: 3,
  });

  const questions = [
    "AI-generated deepfakes will determine future elections",
    "Most people canâ€™t distinguish AI-generated from authentic content",
    "AI is a greater threat than voter suppression, gerrymandering, or institutional attacks",
  ];

  const handleChange = (q, value) => {
    setResponses((prev) => ({ ...prev, [q]: parseInt(value) }));
  };

  const handleSubmit = async () => {
    try {
      await addDoc(collection(db, "responses"), {
        ...responses,
        createdAt: Timestamp.now(),
      });
      alert("Response submitted!");
    } catch (e) {
      console.error("Error adding document: ", e);
    }
  };

  return (
    <div style={{ padding: "2rem" }}>
      <h1>Survey</h1>
      {questions.map((q, idx) => (
        <div key={idx} style={{ marginBottom: "1rem" }}>
          <p>{q}</p>
          {[1, 2, 3, 4, 5].map((n) => (
            <label key={n} style={{ marginRight: "1rem" }}>
              <input
                type="radio"
                name={`q${idx + 1}`}
                value={n}
                checked={responses[`q${idx + 1}`] === n}
                onChange={(e) => handleChange(`q${idx + 1}`, e.target.value)}
              />
              {n}
            </label>
          ))}
        </div>
      ))}
      <button onClick={handleSubmit}>Submit</button>
    </div>
  );
};

export default Survey;
